groups:
  - name: flask-app-alerts
    interval: 1m
    rules:
      - uid: alert-traffic-high
        title: Alerta de Tr√°fego Alto
        condition: C
        data:
          - refId: A
            relativeTimeRange:
              from: 60
              to: 0
            datasourceUid: ${DATASOURCE_NAME}
            model:
              expr: rate(flask_http_request_total[1m])
              format: time_series
              interval: ""
              intervalFactor: 2
              legendFormat: "Tr√°fego"
              refId: A
              datasource:
                type: prometheus
                uid: ${DATASOURCE_NAME}
          - refId: C
            type: "reduce"
            datasourceUid: "-- Mixed --"
            model:
              refId: C
              type: avg
              params: []
              reducer: avg
              input: A
        thresholds:
          - level: 1
            operator: "gt"
            value: 10
        annotations:
          summary: "‚ö†Ô∏è Tr√°fego alto detectado"
          description: "A m√©dia de requisi√ß√µes por segundo excedeu 10 req/s"
        labels:
          severity: warning

      - uid: alert-errors-5xx
        title: Alerta de Erros 5xx
        condition: C
        data:
          - refId: A
            relativeTimeRange:
              from: 60
              to: 0
            datasourceUid: ${DATASOURCE_NAME}
            model:
              expr: rate(flask_http_request_total{status=~"5.."}[1m])
              format: time_series
              interval: ""
              intervalFactor: 2
              legendFormat: "Erros 5xx"
              refId: A
              datasource:
                type: prometheus
                uid: ${DATASOURCE_NAME}
          - refId: C
            type: "reduce"
            datasourceUid: "-- Mixed --"
            model:
              refId: C
              type: sum
              params: []
              reducer: sum
              input: A
        thresholds:
          - level: 1
            operator: "gt"
            value: 0
        annotations:
          summary: "üî• Erros 5xx detectados"
          description: "Foram detectadas respostas HTTP com status 5xx na aplica√ß√£o."
        labels:
          severity: critical
